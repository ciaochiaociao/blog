---
title: Pandas
---

## `DataFrame` Instantiation

- `pd.DataFrame(data=None, index=None, columns=None, dtype=None, copy=False)`

  **data**: 

  - `ndarray` (structured or homogeneous)

  -  `Iterable`: 
    - `List`: `[20, 33, 1]`
    - `List[Dict]`: `[{'col1': 20, 'col2': 'Apple'}, {'col1': 33, 'col2': 'Banana'}, ...]`
  - `dict`: Dict can contain Series, arrays, constants, or list-like objects.
    - e.g. `{'col1': pd.Series([20, 33, 1]), 'col2': ['Apple', 'Banana', 'Cranberry']}`
  -  `DataFrame`

- `DataFrame.from_records(List[Tuple])`

  - e.g. `DataFrame.from_records([(20, 'Apple'), (33, 'Banana'), ...])`
  - also support `structured ndarray, List[Dict]], DataFrame` as `DataFrame.__init__`

- `DataFrame.from_dict()`

  - `DataFrame.from_dict(data, orient='columns')` (default)
  - `DataFrame.from_dict(data, orient='index')`

## Serialization

```
df.to_records()
```



### List to Series/DataFrame

```
s = pd.Series(["a", "b", "c"],
              name="vals")
s.to_frame()

s = pd.Series(["a", "b", "c"])
s.to_frame("vals")

df = pd.DataFrame([30, 22, 111], columns=["counts"])
```

## Indexing

```
df.where( ... == ... )
df[df['名'].str.contains(r"^胡.*心", regex=True, na=False)]
df.query('名 == "胡{璁心"')
df.loc[]
df.iloc[]
df[:, col]
df.shape
```


## Reshaping: Pivot/Groupby/Stack/Unstack/Melt
ref: https://pandas.pydata.org/pandas-docs/stable/user_guide/reshaping.htm
```
df.pivot(...)

df = pd.DataFrame(dict(zip(['qid', 'amodule', 'atype', 'score', 'pred', 'gold'], [error_ids, error_modules, error_atypes, error_scores, error_preds, error_golds])))
df.groupby('amodule').count()
pt = df.pivot_table(index=['amodule'], columns=['atype'], values=['score'], aggfunc=lambda l: l.to_list())

pt.stack()

pt.unstack()
```

- stack: 
	- col header(data value) moved to the corresponding data element to the index(row) under new column
	- multiindex has 1 one more index
- unstack: 
	- index(row) -> col
	- multiinex


> stack: “pivot” a level of the (possibly hierarchical) column labels, returning a DataFrame with an index with a new inner-most level of row labels.
> unstack: (inverse operation of stack) “pivot” a level of the (possibly hierarchical) row index to the column axis, producing a reshaped DataFrame with a new inner-most level of column labels.

## Plot

```
df.plot(kind='...')
df.plot.<kind>

df.plot.line()
df.plot.bar()
df.plot.hist(bins=50)
df.plot.density(bw_method=0.01)  # bandwidth
df.plot.kde()
df.plot.pie

from pandas.plotting import parallel_coordinates
parallel_coordinates(data, 'species', colormap=plt.get_cmap("Set2"))

```



## Others

```
df.rename_axis('index_axis_name')
df.rename_axis(index='index_axis_name')
df.rename_axis(columns='column_axis_name')

df.sort_index(ascending=False)

df.describe()
s.describe()

df.reindex(indexorder, columns=columnorder)

df.T

df.sum()

df.iterrows()

# make bins
pd.cut(s, [-0.01] + list(pd.np.arange(max_range)) + [pd.np.inf], labels=False)
```

## Seaborn

```
df = sns.load_dataset('iris')

cmap = sns.cubehelix_palette(as_cmap=True, light=.9)

sns.violinplot(y=df["species"], x=df["sepal_length"])
sns.kdeplot(df['sepal_width'])
sns.distplot(flights['arr_delay'], 
			hist=True, 
			kde=True, 
			# rug = True,
             bins=int(180/5), 
             color = 'darkblue', 
             hist_kws={'edgecolor':'black'},
             kde_kws={'linewidth': 4})
sns.heatmap(err_df, annot=True, linewidth=1, fmt='.0f', cmap=cmap, **kwargs)
plot.set_facecolor(np.append(cmap.colors[0][:-1], 0.5))
plot.set_xticklabels(plot.get_xticklabels(), rotation=45)

sns.plt.show()
```
